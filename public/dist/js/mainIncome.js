(()=>{function e(e){$("#total-item-td"),$("#remaining-bill-td");$.ajax({type:"POST",url:base_url+"/incomes/append-payment-detail",data:{income_id:e},beforeSend:function(){},success:function(e){$("#target-payment-detail").html(e.data.tr)}})}$("#user").chosen({width:"100%"}),$("#institution_id").chosen({width:"100%"}),$("#income_type_id").chosen({width:"100%"}),$("#income_method_id").chosen({width:"100%"}),window.getDetailUser=function(e){var n=e.value;$.ajax({type:"POST",url:base_url+"/incomes/get-detail-user",data:{user_id:n},success:function(e){$(".detail-user").html(e.view);for(var n="<option></option>",t=0;t<e.data.institutions.length;t++)n+='<option value="'.concat(e.data.institutions[t].id,'" ').concat(e.data.institutions[t].selected,">\n            \t\t\t").concat(e.data.institutions[t].name,"\n            \t\t</option>");$("#institution_id").html(n),"internal"==e.data.type?$("#institution_id").prop("readonly",!0):$("#institution_id").prop("readonly",!1),$("#institution_id").chosen("destroy"),$("#institution_id").chosen({width:"100%"})}})},window.checkInvoiceNumber=function(e){var n=e.value;$.ajax({type:"POST",url:base_url+"/incomes/check-invoice-number",data:{invoice_number:n},success:function(e){e.data.available?($("#form-group-invoice-number").removeClass("has-warning"),$("#form-group-invoice-number .help-block").addClass("d-none"),$("#btn-save-invoice").prop("disabled",!1)):($("#form-group-invoice-number").addClass("has-warning"),$("#form-group-invoice-number .help-block").removeClass("d-none"),$("#btn-save-invoice").prop("disabled",!0))}})},window.addItem=function(){$(".table-item");var e=$(".tr-item").length;$.ajax({type:"POST",url:base_url+"/incomes/build-item-row",data:{len:e},success:function(e){$(".table-item tbody").append(e.view),$(".td-delete-0").removeClass("d-none"),$(".th-additional").removeClass("d-none")}})},window.deleteRow=function(e){var n=$(".tr-item");$("#tr-item-"+e).remove(),2==n.length&&($(".td-delete-0").addClass("d-none"),$(".th-additional").addClass("d-none"))},window.updateTotal=function(){for(var e=$(".price_item"),n=[],t=[],a=0;a<e.length;a++){var o=e[a].id;t.push(o),n.push($("#"+o).val())}var i=n.reduce((function(e,n){return parseInt(e)+parseInt(n)}),0);res=numberWithCommas(i),$("#amount_total").val(res),$("#remaining_bill").val(res)},window.updateValue=function(e){var n=e.value;e.value=parseInt(n)},window.saveItem=function(){$("#form-invoice");var e=new FormData($("#form-invoice")[0]),n=CKEDITOR.instances.ckeditor_message.getData();e.append("message",n),$.ajax({type:"POST",url:base_url+"/incomes",data:e,contentType:!1,processData:!1,beforeSend:function(){disableButton("btn-save-invoice")},success:function(e){disableButton("btn-save-invoice",!1),showNotif(!1,e.message),window.location.href=base_url+"/incomes/"+e.data.item.id},error:function(e){disableButton("btn-save-invoice",!1),showNotif(!0,e)}})},window.appendPaymentDetail=e,window.pay=function(n){$("#form-payment");var t=new FormData($("#form-payment")[0]);$.ajax({type:"POST",url:base_url+"/incomes/pay",data:t,contentType:!1,processData:!1,beforeSend:function(){disableButton("btn-add-payment",!0,i18n.view.pay)},success:function(n){showNotif(!1,n.message),disableButton("btn-add-payment",!1,i18n.view.pay),initTransaction(n.data),e(n.data)},error:function(e){showNotif(!0,e),disableButton("btn-add-payment",!1,i18n.view.pay)}})},window.validatePaymentAmount=function(e,n){var t=e.value;parseInt(t)>parseInt(n)?($("#btn-add-payment").prop("disabled",!0),$("#form-group-payment-amount").addClass("has-warning"),$("#form-group-payment-amount .help-block").html(i18n.view.payment_amount_exceed)):($("#btn-add-payment").prop("disabled",!1),$("#form-group-payment-amount").removeClass("has-warning"),$("#form-group-payment-amount .help-block").html("")),t=t.replace(/\D+/,""),e.value=t},window.normalizeValue=function(e){var n=e.value.toString().replace(",","").replace(",","").replace(",","");e.value=n},window.changeToThousand=function(e){var n=e.value;n=numberWithCommas(n),e.value=n},window.openProofofPayment=function(e){$.ajax({type:"POST",url:base_url+"/incomes/proof-of-payment",data:{income_payment_id:e},success:function(e){$("#modalProofPayment").modal("show"),$("#modalProofPayment .modal-body").html(e.view)},error:function(e){showNotif(!0,e)}})}})();